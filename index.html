<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>U.S.A. Parts Made Fast</title>
<link rel="icon" type="image/svg+xml" href="Flag_of_the_United_States.svg">

<!-- Open Graph / Facebook / LinkedIn -->
<meta property="og:type"        content="website">
<meta property="og:url"         content="https://partsmadefast.com/">
<meta property="og:title"       content="U.S.A. Parts Made Fast">
<meta property="og:description" content="A community-curated directory of U.S.-based quick-turn manufacturers.">
<meta property="og:image"       content="https://partsmadefast.com/Flag_of_the_United_States.png">

<!-- X Card -->
<meta name="twitter:card"        content="summary_large_image">
<meta name="twitter:url"         content="https://partsmadefast.com/">
<meta name="twitter:title"       content="U.S.A. Parts Made Fast">
<meta name="twitter:description" content="A community-curated directory of U.S.-based quick-turn manufacturers.">
<meta name="twitter:image"       content="https://partsmadefast.com/Flag_of_the_United_States.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0d0d;
    --surface: #141414;
    --surface2: #1c1c1c;
    --surface3: #222;
    --border: #2a2a2a;
    --accent: #e8a020;
    --accent2: #c0392b;
    --text: #e8e8e8;
    --muted: #888;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    font-size: 15px;
    line-height: 1.5;
    min-height: 100vh;
  }

  /* HEADER */
  header {
    background: var(--surface);
    border-bottom: 3px solid var(--accent);
    padding: 24px 40px 20px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
    position: relative;
    z-index: 91;
  }
  .flag-stripe { display: flex; gap: 4px; margin-bottom: 8px; }
  .flag-stripe span { display: block; height: 5px; border-radius: 2px; }
  .flag-stripe .red   { background: #b22234; width: 40px; }
  .flag-stripe .white { background: #eee;    width: 40px; }
  .flag-stripe .blue  { background: #3c3b6e; width: 40px; }
  h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 44px; font-weight: 900;
    letter-spacing: 1px; line-height: 1;
    color: #fff; text-transform: uppercase;
  }
  h1 span { color: var(--accent); }
  .tagline { margin-top: 8px; color: var(--muted); font-size: 14px; max-width: 520px; line-height: 1.6; }
  .header-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding-top: 4px; }

  /* BUTTONS */
  .btn {
    display: inline-flex; align-items: center; gap: 7px;
    padding: 9px 18px; border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 700; letter-spacing: 0.5px;
    text-transform: uppercase; cursor: pointer; border: none;
    text-decoration: none; transition: all 0.15s; white-space: nowrap;
  }
  .btn-primary  { background: var(--accent); color: #000; border: 1.5px solid transparent; }
  .btn-primary:hover  { background: #f5b840; }
  .btn-outline  { background: transparent; color: var(--text); border: 1.5px solid var(--border); }
  .btn-outline:hover  { border-color: var(--accent); color: var(--accent); }
  .btn-danger   { background: var(--accent2); color: #fff; font-size: 12px; padding: 5px 10px; }
  .btn-danger:hover   { background: #e74c3c; }
  .btn-warn     { background: #2c1f05; color: var(--accent); border: 1.5px solid var(--accent); font-size: 12px; padding: 5px 10px; }
  .btn-warn:hover     { background: var(--accent); color: #000; }
  .btn-instant  { background: #1a1a1a; color: #ccc; border: 1.5px solid #444; }
  .btn-instant:hover  { border-color: #4ade80; color: #4ade80; background: #0a1a0a; }
  .btn-instant.active { background: #052e16; color: #4ade80; border-color: #166534; }
  .btn-uber     { background: #1a1a1a; color: #ccc; border: 1.5px solid #444; }
  .btn-uber:hover     { border-color: #c4b5fd; color: #c4b5fd; background: #100a1a; }
  .btn-uber.active    { background: #1a0a2e; color: #c4b5fd; border-color: #6d28d9; }

  /* TOOLBAR */
  .toolbar {
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    padding: 12px 40px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    position: sticky;
    top: 0;
    z-index: 90;
  }

  /* Search */
  .search-wrap { position: relative; flex: 1; min-width: 160px; max-width: 260px; }
  .search-wrap .ico {
    position: absolute; left: 11px; top: 50%;
    transform: translateY(-50%); color: var(--muted); font-size: 14px; pointer-events: none;
  }
  .search-wrap input {
    width: 100%; background: #1a1a1a;
    border: 1.5px solid #444; border-radius: 4px;
    color: var(--text); font-family: 'Barlow', sans-serif;
    font-size: 14px; padding: 8px 12px 8px 32px; outline: none;
    transition: border-color 0.15s;
  }
  .search-wrap input:focus { border-color: var(--accent); }
  .search-wrap input::placeholder { color: var(--muted); }

  /* Dropdowns */
  .dropdown-wrap { position: relative; }
  .dropdown-trigger {
    display: flex; align-items: center; gap: 8px;
    background: #1a1a1a; border: 1.5px solid #444;
    border-radius: 4px; color: #ccc;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 15px; font-weight: 600; letter-spacing: 0.3px;
    padding: 8px 14px; cursor: pointer; white-space: nowrap;
    min-width: 180px; justify-content: space-between;
    transition: border-color 0.15s; user-select: none;
  }
  .dropdown-trigger:hover,
  .dropdown-trigger.open { border-color: var(--accent); color: var(--accent); }
  .dropdown-trigger .arrow { font-size: 10px; transition: transform 0.2s; opacity: 0.6; }
  .dropdown-trigger.open .arrow { transform: rotate(180deg); }
  .dropdown-trigger .selected-val { flex: 1; text-align: left; overflow: hidden; text-overflow: ellipsis; }

  .dropdown-menu {
    display: none; position: absolute; top: calc(100% + 4px); left: 0;
    min-width: 100%; background: var(--surface2);
    border: 1.5px solid var(--accent); border-radius: 4px;
    z-index: 200; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.6);
  }
  .dropdown-menu.open { display: block; }
  .dropdown-search { padding: 8px; border-bottom: 1px solid var(--border); }
  .dropdown-search input {
    width: 100%; background: var(--surface); border: 1px solid var(--border);
    border-radius: 3px; color: var(--text);
    font-family: 'Barlow', sans-serif; font-size: 13px;
    padding: 6px 10px; outline: none;
  }
  .dropdown-search input:focus { border-color: var(--accent); }
  .dropdown-search input::placeholder { color: var(--muted); }
  .dropdown-list { max-height: 260px; overflow-y: auto; }
  .dropdown-list::-webkit-scrollbar { width: 4px; }
  .dropdown-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .dropdown-item {
    padding: 9px 14px; cursor: pointer; font-size: 14px;
    display: flex; align-items: center; gap: 8px;
    transition: background 0.1s; white-space: nowrap;
  }
  .dropdown-item:hover { background: var(--surface3); color: var(--accent); }
  .dropdown-item.selected { color: var(--accent); background: #1a1200; }
  .dropdown-item.all-option { color: var(--muted); border-bottom: 1px solid var(--border); font-style: italic; }
  .dropdown-item.all-option.selected { color: var(--accent); }

  .divider { width: 1px; height: 24px; background: var(--border); flex-shrink: 0; }

  .clear-btn {
    background: none; border: none; color: var(--muted);
    font-size: 12px; font-family: 'Barlow', sans-serif;
    cursor: pointer; text-decoration: underline; white-space: nowrap;
  }
  .clear-btn:hover { color: var(--accent); }

  .result-bar { margin-left: auto; color: var(--muted); font-size: 13px; white-space: nowrap; }
  .result-bar strong { color: var(--accent); }

  /* MAIN */
  main { max-width: 1200px; margin: 0 auto; padding: 36px 40px 80px; }

  .category-section { margin-bottom: 48px; }
  .category-header {
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 16px; padding-bottom: 12px;
    border-bottom: 2px solid var(--border);
  }
  .category-icon {
    font-size: 20px; width: 40px; height: 40px;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 6px; display: flex; align-items: center;
    justify-content: center; flex-shrink: 0;
  }
  .category-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 26px; font-weight: 800;
    text-transform: uppercase; letter-spacing: 1px; color: #fff;
  }
  .category-count { margin-left: auto; font-size: 12px; color: var(--muted); font-family: 'Barlow Condensed', sans-serif; letter-spacing: 1px; text-transform: uppercase; }
  .section-stripe { height: 1px; background: linear-gradient(to right, var(--accent), transparent); margin-bottom: 16px; opacity: 0.35; }

  .mfr-list { display: flex; flex-direction: column; gap: 2px; }
  .mfr-card {
    background: var(--surface); border: 1px solid var(--border);
    border-left: 3px solid transparent; border-radius: 4px;
    padding: 12px 16px;
    display: flex; flex-direction: column; gap: 6px;
    transition: all 0.15s;
    animation: fadeIn 0.2s ease both;
  }
  .mfr-card:hover { background: var(--surface2); border-left-color: var(--accent); cursor: pointer; }
  .mfr-card-top {
    display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
  }
  .mfr-card-bottom {
    display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
    padding-top: 4px; border-top: 1px solid var(--border);
  }
  .mfr-machines {
    font-size: 12px;
    font-family: 'Barlow', sans-serif;
    color: #bbb;
    flex: 1;
  }
  .cap-label {
    color: var(--accent);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-right: 4px;
  }
  .mfr-name {
    font-family: 'Barlow Condensed', sans-serif; font-size: 20px;
    font-weight: 700; color: #fff; text-decoration: none;
    transition: color 0.15s;
  }
  .mfr-name:hover { color: var(--accent); }
  .mfr-meta { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; flex: 1; }
  .mfr-location {
    font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    color: #9ca3af;
    letter-spacing: 0.4px;
    text-transform: uppercase;
    white-space: nowrap;
    display: flex; align-items: center; gap: 4px;
  }
  .mfr-dims {
    flex-shrink: 0;
    font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #aaa;
    text-transform: uppercase;
    white-space: nowrap;
    align-self: center;
    line-height: 1.5;
    text-align: right;
    margin-left: auto;
  }
  .tag {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 9px; border-radius: 3px; font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
    letter-spacing: 0.4px; text-transform: uppercase; white-space: nowrap;
  }
  .tag-state        { background: #111827; border: 1px solid #374151; color: #9ca3af; }
  .tag-instant      { background: #052e16; border: 1px solid #166534; color: #4ade80; }
  .tag-manual       { background: #172554; border: 1px solid #1e40af; color: #93c5fd; }
  .tag-online-manual{ background: #172554; border: 1px solid #1e40af; color: #93c5fd; }
  .tag-email        { background: #1c1008; border: 1px solid #78350f; color: #fbbf24; }
  .tag-uber         { background: #1a0a2e; border: 1px solid #6d28d9; color: #c4b5fd; }
  .tag-beta         { background: #1a100a; border: 1px solid #92400e; color: #fbbf24; }
  .tag-dims         { background: #111; border: 1px solid #333; color: #666; font-size: 11px; }
  .mfr-actions { display: flex; gap: 6px; flex-shrink: 0; }
  .add-mfr-btn {
    display: inline-flex;
    align-items: center;
    margin-top: 8px;
    background: #1c1400;
    border: 1px dashed var(--accent);
    border-radius: 4px;
    color: var(--accent);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    padding: 6px 14px;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.15s;
  }
  .add-mfr-btn:hover { background: var(--accent); color: #000; border-style: solid; }

  .add-info-btn {
    background: none;
    border: 1px dashed #555;
    border-radius: 3px;
    color: #777;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    padding: 2px 8px;
    cursor: pointer;
    white-space: nowrap;
    text-decoration: none;
    transition: all 0.15s;
    display: inline-flex;
    align-items: center;
  }
  .add-info-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* Empty state */
  .empty-state { text-align: center; padding: 80px 20px; color: var(--muted); }
  .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; }
  .empty-state h3 { font-size: 22px; margin-bottom: 8px; color: var(--text); }

  /* MODALS */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.85); z-index: 1000;
    justify-content: center; align-items: center; padding: 20px;
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: var(--surface); border: 1px solid var(--border);
    border-top: 3px solid var(--accent); border-radius: 6px;
    padding: 32px; max-width: 480px; width: 100%; position: relative;
  }
  .modal h3 { font-family: 'Barlow Condensed', sans-serif; font-size: 22px; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; }
  .modal p { color: var(--muted); font-size: 13px; margin-bottom: 20px; }
  .modal .close-btn { position: absolute; top: 14px; right: 16px; background: none; border: none; color: var(--muted); font-size: 22px; cursor: pointer; line-height: 1; }
  .modal .close-btn:hover { color: #fff; }
  .modal-options { display: flex; flex-direction: column; gap: 12px; }
  .modal-option-btn {
    display: flex; align-items: center; gap: 12px; padding: 16px;
    background: var(--surface2); border: 1.5px solid var(--border);
    border-radius: 6px; cursor: pointer; text-decoration: none;
    color: var(--text); transition: all 0.15s;
  }
  .modal-option-btn:hover { border-color: var(--accent); background: #1a1200; }
  .modal-option-btn .opt-icon { font-size: 24px; flex-shrink: 0; }
  .modal-option-btn .opt-label { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 700; text-transform: uppercase; }
  .modal-option-btn .opt-sub { font-size: 12px; color: var(--muted); }

  /* FOOTER */
  footer { background: var(--surface); border-top: 1px solid var(--border); padding: 24px 40px; text-align: center; color: var(--muted); font-size: 13px; }
  footer a { color: var(--accent); text-decoration: none; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }


  @media (max-width: 768px) {
    header { padding: 20px; }
    h1 { font-size: 32px; }
    .tagline { font-size: 13px; }
    .header-actions { gap: 8px; flex-wrap: nowrap; width: 100%; }
    .header-actions .btn { font-size: 12px; padding: 7px 10px; flex: 1; justify-content: center; align-items: center; white-space: nowrap; display: flex; line-height: 1; }
    .header-actions .btn-outline { background: transparent; border: 1.5px solid var(--accent); color: var(--text); }
    .header-actions .btn-outline:hover { background: transparent; border-color: var(--accent); color: var(--accent); }

    .toolbar { padding: 10px 16px; gap: 8px; }
    /* Search takes its own full row */
    .search-wrap { max-width: 100%; min-width: 100%; order: -1; flex-basis: 100%; }
    /* Dropdowns share a row and stretch equally */
    .dropdown-wrap { flex: 1; }
    .dropdown-trigger { min-width: 0; width: 100%; }
    .result-bar { order: 99; width: 100%; margin-left: 0; font-size: 12px; }

    main { padding: 24px 16px 60px; }
    .category-title { font-size: 22px; }

    .mfr-card { flex-direction: column; align-items: flex-start; }
    .mfr-actions { margin-left: 0; flex-wrap: wrap; }
    /* Card bottom stacks vertically on mobile */
    .mfr-card-bottom { flex-direction: column; align-items: flex-start; gap: 8px; }
    .mfr-dims { margin-left: 0; text-align: left; white-space: normal; }

    footer { padding: 20px 16px; }
    .modal { padding: 24px 16px; }
    .modal-overlay { padding: 12px; }
  }

  /* FORMS */
  .modal-form { display: flex; flex-direction: column; gap: 14px; }
  .form-group { display: flex; flex-direction: column; gap: 5px; }
  .form-group label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.6px; color: var(--muted);
  }
  .form-group label .opt { font-weight: 400; text-transform: none; letter-spacing: 0; }
  .form-group input,
  .form-group textarea,
  .form-group select {
    background: var(--surface2); border: 1.5px solid var(--border); border-radius: 4px;
    color: var(--text); font-family: 'Barlow', sans-serif; font-size: 14px;
    padding: 9px 12px; outline: none; transition: border-color 0.15s; width: 100%;
  }
  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus { border-color: var(--accent); }
  .form-group input::placeholder,
  .form-group textarea::placeholder { color: #555; }
  .form-group textarea { resize: vertical; min-height: 72px; line-height: 1.5; }
  .form-group select { cursor: pointer; -webkit-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23888' d='M5 7L0 2h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center; }
  .form-group input.invalid { border-color: var(--accent2); }
  .form-row { display: flex; gap: 10px; }
  .form-row .form-group { flex: 1; min-width: 0; }
  .form-context {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 4px;
    padding: 7px 12px; font-size: 13px; color: var(--muted);
  }
  .form-context strong { color: var(--text); font-weight: 600; }
  .field-hidden { display: none !important; }

  .toast {
    position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(20px);
    background: #1a2e1a; border: 1px solid #166534; color: #4ade80;
    font-family: 'Barlow Condensed', sans-serif; font-size: 16px; font-weight: 700;
    letter-spacing: 0.5px; padding: 12px 28px; border-radius: 6px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6); z-index: 9999;
    opacity: 0; transition: opacity 0.2s, transform 0.2s; pointer-events: none;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div>
    <div class="flag-stripe">
      <span class="red"></span><span class="white"></span><span class="blue"></span>
    </div>
    <h1 onclick="clearFilters()" style="cursor:pointer">U.S.A. <span>Parts Made Fast</span></h1>
    <p class="tagline">U.S.-based manufacturers offering quick-turn solutions.<br>Parts delivered to your door <strong>in under 7 days</strong>, assemblies <strong>... a little bit after that</strong>.</p>
    <p class="tagline" style="margin-top:20px; font-size:13px; font-style:italic;">My hope is that this list helps you find quick-turn partners and reveals where gaps exist: processes still waiting to be brought to quick-turn, and legacy industries yet to unlock instant quoting.</p>
  </div>
  <div class="header-actions">
    <button class="btn btn-primary" onclick="openSubmitModal()">+ Submit Manufacturer</button>
    <button class="btn btn-outline" onclick="openUpdateModal('','','incorrect')">Report Incorrect Info</button>
  </div>
</header>

<!-- ALWAYS-VISIBLE TOOLBAR -->
<div class="toolbar">

  <!-- Text search -->
  <div class="search-wrap">
    <span class="ico">üîç</span>
    <input type="text" id="search-input" placeholder="Search processes‚Ä¶" oninput="applyFilters()">
  </div>

  <div class="divider"></div>

  <!-- Process dropdown -->
  <div class="dropdown-wrap" id="process-wrap">
    <div class="dropdown-trigger" id="process-trigger" onclick="toggleDropdown('process')">
      <span class="selected-val" id="process-label">All Processes</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="dropdown-menu" id="process-menu">
      <div class="dropdown-search">
        <input type="text" placeholder="Search process‚Ä¶" oninput="filterDropdownItems('process', this.value)">
      </div>
      <div class="dropdown-list" id="process-list"></div>
    </div>
  </div>

  <!-- State dropdown -->
  <div class="dropdown-wrap" id="state-wrap">
    <div class="dropdown-trigger" id="state-trigger" onclick="toggleDropdown('state')">
      <span class="selected-val" id="state-label">All States</span>
      <span class="arrow">‚ñº</span>
    </div>
    <div class="dropdown-menu" id="state-menu">
      <div class="dropdown-search">
        <input type="text" placeholder="Search state‚Ä¶" oninput="filterDropdownItems('state', this.value)">
      </div>
      <div class="dropdown-list" id="state-list"></div>
    </div>
  </div>

  <div class="divider"></div>

  <!-- Instant quote toggle -->
  <button class="btn btn-instant" id="instant-btn" onclick="toggleInstant()">‚ö° Instant Quote Only</button>

  <!-- Uber carrier toggle -->
  <button class="btn btn-uber" id="uber-btn" onclick="toggleUber()">üöó Uber Courier Available</button>

  <!-- Clear -->
  <button class="clear-btn" id="clear-btn" onclick="clearFilters()" style="display:none">‚úï Clear filters</button>


</div>

<!-- BETA DISCLAIMER -->
<p style="text-align:center; padding: 10px 40px 0; font-size:12px; color:var(--accent);">Manufacturers marked <strong>Beta</strong> may be in closed beta or not yet at full production capacity.</p>
<p style="text-align:center; padding: 20px 40px 0; font-size:11px; color:var(--muted); letter-spacing:0.3px;">Categories and manufacturers are reshuffled on every page load ‚Äî no placement is paid or permanent.</p>

<!-- MAIN -->
<main id="main-content"></main>

<!-- REQUEST PROCESS -->
<div style="text-align:center; padding: 16px 40px 60px;">
  <button onclick="openUpdateModal('','','request')"
     style="display:inline-flex; align-items:center; gap:10px;
            background:var(--accent); color:#000;
            font-family:'Barlow Condensed',sans-serif; font-size:20px;
            font-weight:800; letter-spacing:1px; text-transform:uppercase;
            border:none; padding:16px 36px; border-radius:4px;
            cursor:pointer; transition:background 0.15s;">
    ‚ûï Request a Manufacturing Process
  </button>
  <p style="margin-top:12px; font-size:13px; color:var(--muted);">Don't see your process? Request it and we'll work to find a quick-turn supplier.</p>
</div>

<!-- FOOTER -->
<footer>
  <p>üá∫üá∏ <strong>U.S.A. Parts Made Fast</strong> ‚Äî A community-curated directory of quick-turn American manufacturers.</p>
  <p style="margin-top:6px;">Something missing? <a href="#" onclick="openSubmitModal();return false;">Submit a manufacturer</a> ¬∑ <a href="#" onclick="openUpdateModal('','','incorrect');return false;">Report incorrect information</a></p>
</footer>

<!-- SUBMIT MANUFACTURER MODAL -->
<div class="modal-overlay" id="submit-modal">
  <div class="modal" style="max-width:540px">
    <button class="close-btn" onclick="closeModal('submit-modal')">‚úï</button>
    <h3>üè≠ Submit a Manufacturer</h3>
    <p>Know a U.S. shop that delivers parts fast? Add it to the directory.</p>
    <div class="modal-form" id="submit-form">
      <div class="form-group">
        <label>Company Name *</label>
        <input type="text" id="sm-name" placeholder="Acme Manufacturing Co.">
      </div>
      <div class="form-group">
        <label>Website URL *</label>
        <input type="url" id="sm-url" placeholder="https://acmemfg.com">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>City</label>
          <input type="text" id="sm-city" placeholder="Austin">
        </div>
        <div class="form-group">
          <label>State</label>
          <input type="text" id="sm-state" placeholder="TX" maxlength="2" style="text-transform:uppercase">
        </div>
      </div>
      <div class="form-group">
        <label>Quote Type</label>
        <select id="sm-quote">
          <option value="">Select‚Ä¶</option>
          <option value="instant">‚ö° Instant Quote</option>
          <option value="online-manual">üñ•Ô∏è Online Platform Manual Quote</option>
          <option value="email">‚úâÔ∏è Email/Form Submission Quote</option>
        </select>
      </div>
      <div class="form-group">
        <label>Categories / Capabilities</label>
        <input type="text" id="sm-categories" placeholder="e.g. Laser Cutting, CNC Machining, 3D Printing">
      </div>
      <div class="form-group">
        <label>Notes <span class="opt">(optional)</span></label>
        <textarea id="sm-notes" placeholder="Anything else we should know‚Ä¶"></textarea>
      </div>
      <div class="form-group">
        <label>Your Email <span class="opt">(optional ‚Äî for follow-up)</span></label>
        <input type="email" id="sm-email" placeholder="you@example.com">
      </div>
      <button class="btn btn-primary" id="sm-submit-btn" onclick="submitMfrForm()" style="width:100%;margin-top:4px">Submit Manufacturer</button>
    </div>
    <div class="form-success" id="submit-success">
      <span class="s-icon">‚úì</span>Response submitted.
    </div>
  </div>
</div>

<!-- UPDATE INFO MODAL -->
<div class="modal-overlay" id="update-modal">
  <div class="modal">
    <button class="close-btn" onclick="closeModal('update-modal')">‚úï</button>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
      <span id="um-icon" style="font-size:22px"></span>
      <h3 id="um-title" style="margin:0"></h3>
    </div>
    <div class="form-context field-hidden" id="um-context" style="margin-bottom:14px"></div>
    <div class="modal-form" id="update-form">
      <!-- Editable mfr name ‚Äî shown only when report triggered without context -->
      <div class="form-group field-hidden" id="um-field-mfr">
        <label>Manufacturer</label>
        <input type="text" id="um-mfr-editable" placeholder="e.g. SendCutSend">
      </div>
      <div class="form-group field-hidden" id="um-field-machine">
        <label>Machine / Equipment</label>
        <input type="text" id="um-machine" placeholder="e.g. 5-axis CNC Mill">
      </div>
      <div class="form-group field-hidden" id="um-field-post">
        <label>Post Process</label>
        <input type="text" id="um-post" placeholder="e.g. Anodizing">
      </div>
      <div class="form-group field-hidden" id="um-field-max">
        <label>Max Part Size</label>
        <input type="text" id="um-max" placeholder='e.g. 12" x 24" x 6"'>
      </div>
      <div class="form-group field-hidden" id="um-field-min">
        <label>Min Part Size</label>
        <input type="text" id="um-min" placeholder='e.g. 0.5" x 0.5"'>
      </div>
      <div class="form-group field-hidden" id="um-field-process">
        <label>Manufacturing Process</label>
        <input type="text" id="um-process" placeholder="e.g. Electroforming">
      </div>
      <div class="form-group field-hidden" id="um-field-notes">
        <label>What's incorrect?</label>
        <textarea id="um-notes" placeholder="Describe what needs to be corrected‚Ä¶"></textarea>
      </div>
      <div class="form-group" id="um-field-extra">
        <label>Notes <span class="opt">(optional)</span></label>
        <textarea id="um-extra" placeholder="Any additional context‚Ä¶" style="min-height:54px"></textarea>
      </div>
      <div class="form-group">
        <label>Your Email <span class="opt">(optional)</span></label>
        <input type="email" id="um-email" placeholder="you@example.com">
      </div>
      <button class="btn btn-primary" id="um-submit-btn" onclick="submitUpdateForm()" style="width:100%;margin-top:4px">Submit</button>
    </div>
    <div class="form-success" id="update-success">
      <span class="s-icon">‚úì</span>Response submitted.
    </div>
    <input type="hidden" id="um-mfr-name">
    <input type="hidden" id="um-category">
    <input type="hidden" id="um-type">
    <input type="hidden" id="um-machine-name">
  </div>
</div>

<script>
// ‚îÄ‚îÄ FORM ENDPOINTS ‚îÄ‚îÄ
// Once Google Forms are created, replace PLACEHOLDER values with real form IDs and entry field IDs.
const FORMS = {
  updateInfo: {
    endpoint: 'https://docs.google.com/forms/d/e/1FAIpQLSepzwAHYM0-pl6akH9SkHr3Ftpr88ag_jwwJX2i3v_AMHN5yg/formResponse',
    fields: {
      mfrName:    'entry.2018899847',
      category:   'entry.1350813213',
      updateType: 'entry.823762915',
      machineName:'entry.1051368037',
      machine:    'entry.1459081534',
      postProcess:'entry.219333434',
      minSize:    'entry.1195394525',
      maxSize:    'entry.1871885677',
      notes:      'entry.1167365685',
      email:      'entry.941799479',
    }
  },
  submitMfr: {
    endpoint: 'https://docs.google.com/forms/d/e/1FAIpQLSfBrpMJ2QrUFIgQk-LbyG9KMJgnbnIFWBawDIvvNi3GduM8fQ/formResponse',
    fields: {
      companyName: 'entry.596498910',
      url:         'entry.295182703',
      city:        'entry.1033418585',
      state:       'entry.1594157139',
      quoteType:   'entry.1025588795',
      categories:  'entry.1589974558',
      notes:       'entry.518912417',
      email:       'entry.1039474365',
    }
  }
};

function showToast() {
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

async function postToGoogleForms(endpoint, data) {
  const body = new URLSearchParams();
  Object.entries(data).forEach(([k, v]) => { if (v) body.append(k, v); });
  try { await fetch(endpoint, { method: 'POST', mode: 'no-cors', body }); } catch(e) {}
}

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
// quote: "instant" | "online-manual" | "email"
// uber: bool, beta: bool
// dims: { "Category Name": { min: string|null, max: string|null } }
// machines: { "Category Name": { equip: [...], post: [...] } }
//   equip = physical machines/equipment, post = secondary processes & finishing
const manufacturers = [
  { name: "SendCutSend",      url: "https://sendcutsend.com",               city: "Reno",          state: "NV", quote: "instant",       uber: false, beta: false,
    dims: {
      "Laser Cutting":    { "Fiber Laser": { min: null, max: null }, "CO2 Laser": { min: null, max: null } },
      "Waterjet Cutting": { "Waterjet":    { min: null, max: null } },
      "CNC Milling":      { "5-axis CNC":  { min: null, max: null } },
      "CNC Routing":      { "CNC Router":  { min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":   { equip: ["Fiber Laser", "CO2 Laser"],    post: ["Bending", "Powder Coating", "Anodizing", "Zinc Plating", "Tapping", "Hardware Insertion", "Countersinking", "Dimple Forming", "Deburring"] },
      "Waterjet Cutting":{ equip: ["Waterjet"],              post: ["Bending", "Powder Coating", "Anodizing", "Zinc Plating", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
      "CNC Milling":     { equip: ["5-axis CNC"], post: ["Powder Coating", "Anodizing", "Zinc Plating", "Tapping", "Deburring"] },
      "CNC Routing":     { equip: ["CNC Router"], post: ["Powder Coating", "Anodizing", "Zinc Plating", "Tapping", "Deburring"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Powder Coating", "Anodizing", "Zinc Plating", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
    },
    categories: ["Laser Cutting","Waterjet Cutting","CNC Milling","CNC Routing","Sheet Metal & Plate Bending"] },
  { name: "Laser Bros",       url: "https://laserbros.com",                 city: "Graham",        state: "NC", quote: "instant",       uber: false, beta: false,
    dims: {
      "Laser Cutting":               { "Fiber Laser": { min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":               { equip: ["Fiber Laser"], post: ["Bending", "Orbital Sanding", "Linear Sanding", "Tumble Finish", "Pristine Finish"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Orbital Sanding", "Linear Sanding", "Tumble Finish", "Pristine Finish"] },
    },
    categories: ["Laser Cutting", "Sheet Metal & Plate Bending"] },
  { name: "Fabworks",         url: "https://www.fabworks.com",              city: "Ventura",       state: "CA", quote: "instant",       uber: false, beta: false,
    betaCategories: ["Welding"],
    dims: {
      "Laser Cutting": { "Fiber Laser": { min: null, max: null } },
      "Tube Cutting":  { "5-axis Tube Laser":  { min: null, max: null } },
      "Welding":       { "MIG Welder":  { min: null, max: null }, "TIG Welder": { min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":      { equip: ["Fiber Laser"], post: ["Bending", "Powder Coating", "Tapping", "Hardware Insertion", "Countersinking"] },
      "Tube Cutting":       { equip: ["5-axis Tube Laser"],          post: ["Powder Coating", "Bending", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
      "Welding": { equip: ["MIG Welder", "TIG Welder"],   post: ["Tapping", "Hardware Insertion", "Countersinking"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Powder Coating", "Tapping", "Hardware Insertion", "Countersinking"] },
    },
    categories: ["Laser Cutting","Tube Cutting","Welding","Sheet Metal & Plate Bending"] },
  { name: "RMFG",             url: "https://www.rmfg.com",                  city: "Fort Worth",    state: "TX", quote: "instant",       uber: false, beta: false,
    dims: {
      "Laser Cutting": { "Fiber Laser":  { min: null, max: null } },
      "Welding":       { "MIG Welder": { min: null, max: null }, "TIG Welder": { min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":      { equip: ["Fiber Laser"], post: ["Bending", "Powder Coating", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
      "Welding": { equip: ["MIG Welder", "TIG Welder"],   post: ["Powder Coating", "Tapping", "Hardware Insertion", "Countersinking"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Powder Coating", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
    },
    categories: ["Laser Cutting","Welding","Sheet Metal & Plate Bending"] },
  { name: "OSH Cut",          url: "https://www.oshcut.com",                city: "Columbus",      state: "OH", quote: "instant",       uber: false, beta: false,
    dims: {
      "Laser Cutting":       { "Fiber Laser":    { min: null, max: null } },
      "Tube Cutting":        { "5-axis Tube Laser":     { min: null, max: null } },
      "Tube & Pipe Bending": { "CNC Tube Bender":{ min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":        { equip: ["Fiber Laser"],  post: ["Bending", "Powder Coating", "Bead Blasting", "Tumbling", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
      "Tube Cutting":         { equip: ["5-axis Tube Laser"],    post: ["Powder Coating", "Bead Blasting", "Tumbling", "Tapping", "Deburring"] },
      "Tube & Pipe Bending":  { equip: ["CNC Tube Bender"], post: ["Tube Bending", "Powder Coating", "Bead Blasting", "Deburring"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Powder Coating", "Bead Blasting", "Tumbling", "Tapping", "Hardware Insertion", "Countersinking", "Deburring"] },
    },
    categories: ["Laser Cutting","Tube Cutting","Tube & Pipe Bending","Sheet Metal & Plate Bending"] },
  { name: "Digital Metal",    url: "https://www.digitalmetal.io",           city: "San Francisco", state: "CA", locations: [{city:"San Francisco",state:"CA"},{city:"Austin",state:"TX"}], quote: "instant",       uber: false, beta: false,
    dims: { "Casting & Forging": { "Investment Casting": { min: null, max: null } } },
    machines: {
      "Casting & Forging": { equip: ["Investment Casting"], post: ["Polishing", "Sandblasting"] },
    },
    categories: ["Casting & Forging"] },
  { name: "FinalRev",         url: "https://www.finalrev.com",              city: "Berkeley",      state: "CA", quote: "online-manual", uber: true,  beta: true,
    dims: {
      "Laser Cutting":    { "Fiber Laser":  { min: null, max: null } },
      "Waterjet Cutting": { "Waterjet":     { min: null, max: null } },
      "CNC Milling":      { "3-axis CNC": { min: null, max: null }, "5-axis CNC": { min: null, max: null } },
      "CNC Routing":      { "CNC Router":   { min: null, max: null } },
      "Turning":          { "Millturn":     { min: null, max: null } },
      "Micro Gears":      { "Millturn": { min: null, max: null }, "CNC Router": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting":   { equip: ["Fiber Laser"],              post: ["Countersinking", "Tapping"] },
      "Waterjet Cutting":{ equip: ["Waterjet"],                 post: ["Countersinking", "Tapping"] },
      "CNC Milling":     { equip: ["3-axis CNC", "5-axis CNC"], post: ["Countersinking", "Tapping"] },
      "CNC Routing":     { equip: ["CNC Router"],               post: ["Countersinking", "Tapping"] },
      "Turning":         { equip: ["Millturn"],                 post: ["Countersinking", "Tapping"] },
      "Micro Gears":     { equip: ["Millturn", "CNC Router"], post: [] },
    },
    categories: ["Laser Cutting","Waterjet Cutting","CNC Milling","CNC Routing","Turning","Micro Gears"] },
  { name: "Foundation",       url: "https://www.foundation-industries.com", city: "Redwood City",  state: "CA", quote: "online-manual", uber: true,  beta: true,
    dims: { "CNC Milling": { "3-axis CNC": { min: null, max: null }, "5-axis CNC": { min: null, max: null } } },
    machines: {
      "CNC Milling": { equip: ["3-axis CNC", "5-axis CNC"], post: [] },
    },
    categories: ["CNC Milling"] },
  { name: "Nox Metals",       url: "https://www.noxmetals.co",              city: "Detroit",       state: "MI", quote: "instant",       uber: false, beta: false,
    dims: { "Raw Materials": { "Big Ass Saw": { min: null, max: null }, "Smaller Saws": { min: null, max: null } } },
    machines: {
      "Raw Materials": { equip: ["Big Ass Saw", "Smaller Saws"], post: [] },
    },
    categories: ["Raw Materials"] },
  { name: "OSH Stencils",     url: "https://www.oshstencils.com",           city: "Provo",         state: "UT", quote: "instant",       uber: false, beta: false,
    dims: { "PCB Stencils": { "Laser Cutter": { min: null, max: null } } },
    machines: {
      "PCB Stencils": { equip: ["Laser Cutter"], post: [] },
    },
    categories: ["PCB Stencils"] },
  { name: "MiniProto",        url: "https://www.miniproto.com",             city: "Kingston",      state: "NY", quote: "instant",       uber: false, beta: false,
    dims: {},
    machines: {
      "Cable Harnessing": { equip: [], post: [] },
    },
    categories: ["Cable Harnessing"] },
  { name: "MacroFab",         url: "https://macrofab.com",                  city: "Houston",       state: "TX", quote: "instant",       uber: false, beta: false,
    dims: {},
    machines: {
      "PCBA": { equip: [], post: [] },
    },
    categories: ["PCBA"] },
  { name: "FlashPCB",         url: "https://www.flashpcb.com",              city: "Philadelphia",  state: "PA", quote: "instant",       uber: false, beta: false,
    dims: {},
    machines: {
      "PCBA": { equip: [], post: [] },
    },
    categories: ["PCBA"] },
  { name: "Nebula",           url: "https://buildnebula.com",               city: "El Segundo",    state: "CA", quote: "instant",       uber: false, beta: true,
    dims: {},
    machines: {
      "PCBA": { equip: [], post: [] },
    },
    categories: ["PCBA"] },
  { name: "Blitz Panel",      url: "https://blitzpanel.com",                city: "Austin",        state: "TX", quote: "instant",       uber: false, beta: true,
    dims: {},
    machines: {
      "Control Panel Fabrication": { equip: [], post: [] },
    },
    categories: ["Control Panel Fabrication"] },
  { name: "Ponoko",           url: "https://www.ponoko.com",                city: "Oakland",       state: "CA", quote: "instant",       uber: true,  beta: false,
    dims: {
      "Laser Cutting": { "CO2 Laser": { min: null, max: null }, "Fiber Laser": { min: null, max: null } },
      "Sheet Metal & Plate Bending": { "Press Brake": { min: null, max: null } },
    },
    machines: {
      "Laser Cutting": { equip: ["CO2 Laser", "Fiber Laser"], post: ["Bending", "Powder Coating", "UV Printing", "Tapping"] },
      "Sheet Metal & Plate Bending": { equip: ["Press Brake"], post: ["Powder Coating", "UV Printing", "Tapping"] },
    },
    categories: ["Laser Cutting","Sheet Metal & Plate Bending"] },
  { name: "Streamline 3D",    url: "https://www.streamline-3d.com",         city: "Fresno",        state: "CA", quote: "instant",       uber: false, beta: false,
    dims: { "3D Printing": { "MJF": { min: null, max: null }, "FDM": { min: null, max: null } } },
    machines: {
      "3D Printing": { equip: ["MJF", "FDM"], post: ["Ultimate Finish", "Cerakote", "Vapor Smoothing", "Vibratory Tumbling", "Shot Peen", "Raw Grey", "Dyed Black", "UV Powder Coating"] },
    },
    categories: ["3D Printing"] },
  { name: "Corvallis3D",      url: "https://www.corvallis3d.com",           city: "Beaverton",     state: "OR", quote: "instant",       uber: false, beta: false,
    dims: { "3D Printing": { "FDM": { min: null, max: null } } },
    machines: {
      "3D Printing": { equip: ["FDM"], post: [] },
    },
    categories: ["3D Printing"] },
  { name: "JawsTec",          url: "https://www.jawstec.com",               city: "American Falls",state: "ID", quote: "instant",       uber: false, beta: false,
    dims: { "3D Printing": {
      "MJF": { min: null, max: null },
      "SLS": { min: null, max: null },
      "SLA": { min: null, max: null },
      "FDM": { min: null, max: null },
    } },
    machines: {
      "3D Printing": { equip: ["MJF", "SLS", "SLA", "FDM"], post: ["Bead Blasting", "Dyeing", "Vapor Polishing", "Support Removal", "Post-Curing"] },
    },
    categories: ["3D Printing"] },
];

const SYNONYMS = {
  'pipe':       ['tube', 'tubing'],
  'tubing':     ['tube', 'pipe'],
  'tube':       ['pipe', 'tubing'],
  'machining':  ['milling', 'cnc'],
  'milling':    ['machining', 'cnc'],
  'cnc':        ['milling', 'machining', 'routing'],
  'router':     ['routing'],
  'routing':    ['router'],
  'lathe':      ['turning'],
  'turning':    ['lathe'],
  'printing':   ['additive'],
  'additive':   ['printing'],
  'harness':    ['cable', 'harnessing'],
  'harnessing': ['cable', 'harness'],
  'cable':      ['harness', 'harnessing'],
  'casting':    ['forging'],
  'forging':    ['casting'],
  'stamping':   ['forming'],
  'forming':    ['stamping'],
  'molding':    ['injection'],
  'injection':  ['molding'],
  'edm':        ['electrical discharge'],
  'laser':      ['cutting'],
  'weld':       ['welding'],
  'welding':    ['weld'],
  'pcb':        ['pcba', 'circuit', 'board'],
  'pcba':       ['pcb', 'circuit', 'board'],
  'sheet':      ['laser', 'waterjet', 'bending'],
  'plasma':     ['laser', 'cutting'],
  'material':   ['raw', 'stock'],
  'stock':      ['raw', 'material'],
};

const allCategories = [
  { name: "CNC Milling",            icon: "‚öôÔ∏è" },
  { name: "CNC Routing",            icon: "ü™ö" },
  { name: "Turning",                  icon: "üîÅ" },
  { name: "Wire EDM",                 icon: "‚ö°" },
  { name: "Casting & Forging",        icon: "üî•" },
  { name: "Metal Stamping",           icon: "üî®" },
  { name: "Ceramics & Glass",         icon: "üè∫" },
  { name: "Waterjet Cutting",         icon: "üíß" },
  { name: "Laser Cutting",            icon: "üî¶" },
  { name: "Tube Cutting",             icon: "‚úÇÔ∏è" },
  { name: "Tube & Pipe Bending",      icon: "üîÑ" },
  { name: "3D Printing",              icon: "üñ®Ô∏è" },
  { name: "Injection Molding",        icon: "üß™" },
  { name: "Thermoforming",            icon: "üå°Ô∏è" },
  { name: "Metal Forming",            icon: "üî©" },
  { name: "Extrusion",                icon: "üìè" },
  { name: "Welding",                  icon: "üîß" },
  { name: "PCBA",                     icon: "üñ•Ô∏è" },
  { name: "PCB Stencils",             icon: "üî≤" },
  { name: "Control Panel Fabrication",icon: "üî≤" },
  { name: "Cable Harnessing",         icon: "ü™¢" },
  { name: "Wood",                     icon: "ü™µ" },
  { name: "Gear Cutting",             icon: "üî©" },
  { name: "Sheet Metal & Plate Bending", icon: "üìê" },
  { name: "Micro Gears",              icon: "‚öôÔ∏è" },
  { name: "Raw Materials",            icon: "üèóÔ∏è" },
];

// ‚îÄ‚îÄ FILTER STATE ‚îÄ‚îÄ
let selectedProcess = null;
let selectedState   = null;
let instantOnly     = false;
let uberOnly        = false;

// ‚îÄ‚îÄ BUILD DROPDOWNS ‚îÄ‚îÄ
function buildDropdowns() {
  const procList = document.getElementById('process-list');
  procList.innerHTML =
    `<div class="dropdown-item all-option selected" data-value="" onclick="selectDropdown('process',null,'All Processes')">All Processes</div>` +
    allCategories.map(c =>
      `<div class="dropdown-item" data-value="${c.name}" onclick="selectDropdown('process','${c.name.replace(/'/g,"\\'")}','${c.name.replace(/'/g,"\\'")}')">${c.name}</div>`
    ).join('');

  const states = [...new Set(manufacturers.flatMap(m => m.locations ? m.locations.map(l => l.state) : [m.state]))].sort();
  const stateList = document.getElementById('state-list');
  stateList.innerHTML =
    `<div class="dropdown-item all-option selected" data-value="" onclick="selectDropdown('state',null,'All States')">All States</div>` +
    states.map(s =>
      `<div class="dropdown-item" data-value="${s}" onclick="selectDropdown('state','${s}','üìç ${s}')">üìç ${s}</div>`
    ).join('');
}

function toggleDropdown(id) {
  const menu    = document.getElementById(id + '-menu');
  const trigger = document.getElementById(id + '-trigger');
  const isOpen  = menu.classList.contains('open');
  document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
  document.querySelectorAll('.dropdown-trigger').forEach(t => t.classList.remove('open'));
  if (!isOpen) {
    menu.classList.add('open');
    trigger.classList.add('open');
    const si = menu.querySelector('input');
    if (si) { si.value = ''; filterDropdownItems(id, ''); si.focus(); }
  }
}

function selectDropdown(type, value, label) {
  if (type === 'process') {
    selectedProcess = value;
    document.getElementById('process-label').textContent = label;
    document.querySelectorAll('#process-list .dropdown-item').forEach(el =>
      el.classList.toggle('selected', el.dataset.value === (value || '')));
    document.getElementById('process-menu').classList.remove('open');
    document.getElementById('process-trigger').classList.remove('open');
  } else {
    selectedState = value;
    document.getElementById('state-label').textContent = label;
    document.querySelectorAll('#state-list .dropdown-item').forEach(el =>
      el.classList.toggle('selected', el.dataset.value === (value || '')));
    document.getElementById('state-menu').classList.remove('open');
    document.getElementById('state-trigger').classList.remove('open');
  }
  applyFilters();
}

function filterDropdownItems(id, query) {
  const q = query.toLowerCase();
  document.getElementById(id + '-list').querySelectorAll('.dropdown-item').forEach(el => {
    if (el.classList.contains('all-option')) { el.style.display = ''; return; }
    el.style.display = el.textContent.toLowerCase().includes(q) ? '' : 'none';
  });
}

function toggleInstant() {
  instantOnly = !instantOnly;
  document.getElementById('instant-btn').classList.toggle('active', instantOnly);
  applyFilters();
}

function toggleUber() {
  uberOnly = !uberOnly;
  document.getElementById('uber-btn').classList.toggle('active', uberOnly);
  applyFilters();
}

function clearFilters() {
  selectedProcess = null; selectedState = null; instantOnly = false; uberOnly = false;
  document.getElementById('search-input').value = '';
  document.getElementById('process-label').textContent = 'All Processes';
  document.getElementById('state-label').textContent   = 'All States';
  document.getElementById('instant-btn').classList.remove('active');
  document.getElementById('uber-btn').classList.remove('active');
  document.querySelectorAll('#process-list .dropdown-item').forEach(el => el.classList.toggle('selected', el.dataset.value === ''));
  document.querySelectorAll('#state-list .dropdown-item').forEach(el  => el.classList.toggle('selected', el.dataset.value === ''));
  applyFilters();
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function applyFilters() {
  const query = document.getElementById('search-input').value.toLowerCase().trim();
  const isFiltered = selectedProcess || selectedState || instantOnly || uberOnly || query;
  document.getElementById('clear-btn').style.display = isFiltered ? '' : 'none';

  const catsShuffled = shuffle(selectedProcess
    ? allCategories.filter(c => c.name === selectedProcess)
    : [...allCategories]);

  // Always show populated categories before empty ones
  const catsToShow = [
    ...catsShuffled.filter(cat => manufacturers.some(m => {
      if (!m.categories.includes(cat.name)) return false;
      if (selectedState && !(m.locations ? m.locations.some(l => l.state === selectedState) : m.state === selectedState)) return false;
      if (instantOnly && m.quote !== 'instant') return false;
      if (uberOnly && !m.uber) return false;
      return true;
    })),
    ...catsShuffled.filter(cat => !manufacturers.some(m => {
      if (!m.categories.includes(cat.name)) return false;
      if (selectedState && !(m.locations ? m.locations.some(l => l.state === selectedState) : m.state === selectedState)) return false;
      if (instantOnly && m.quote !== 'instant') return false;
      if (uberOnly && !m.uber) return false;
      return true;
    })),
  ];

  // When searching, sort by relevance: categories whose names match more query words come first
  if (query) {
    const words = query.split(/\s+/);
    catsToShow.sort((a, b) => {
      const scoreA = words.filter(w => a.name.toLowerCase().includes(w)).length;
      const scoreB = words.filter(w => b.name.toLowerCase().includes(w)).length;
      return scoreB - scoreA;
    });
  }

  let totalVisible = 0;
  const html = catsToShow.map(cat => {
    // search: split query into words, all must appear somewhere in category name,
    // equipment names, post process names, or manufacturer names
    if (query) {
      const words = query.split(/\s+/);
      const catText = cat.name.toLowerCase();
      const mfrText = manufacturers
        .filter(m => m.categories.includes(cat.name))
        .flatMap(m => {
          const caps = m.machines && m.machines[cat.name];
          return [m.name, ...(caps ? [...(caps.equip || []), ...(caps.post || [])] : [])];
        })
        .join(' ').toLowerCase();
      const searchable = catText + ' ' + mfrText;
      const termSets = words.map(w => [w, ...(SYNONYMS[w] || [])]);
      if (!termSets.every(terms => terms.some(t => searchable.includes(t)))) return '';
    }

    const matching = manufacturers.filter(m => {
      if (!m.categories.includes(cat.name)) return false;
      if (selectedState && !(m.locations ? m.locations.some(l => l.state === selectedState) : m.state === selectedState)) return false;
      if (instantOnly && m.quote !== 'instant') return false;
      if (uberOnly && !m.uber) return false;
      return true;
    });
    if (!matching.length) {
      return `
      <div class="category-section">
        <div class="category-header">
          <span class="category-title">${cat.name}</span>
        </div>
        <div class="section-stripe"></div>
        <button class="add-mfr-btn" onclick="openSubmitModal()">+ Add Manufacturer</button>
      </div>`;
    }
    totalVisible += matching.length;

    const pins = (pinnedTop[cat.name] || [])
      .map(n => matching.find(m => m.name === n))
      .filter(Boolean);
    const rest = shuffle(matching.filter(m => !pins.includes(m)));
    const ordered = [...pins, ...rest];

    const cards = ordered.map((m, i) => {
      const catCaps = m.machines && m.machines[cat.name];
      const equipList = catCaps && catCaps.equip && catCaps.equip.length ? catCaps.equip.join(', ') : null;
      const postList  = catCaps && catCaps.post  && catCaps.post.length  ? catCaps.post.join(', ')  : null;
      const mfrEsc = m.name.replace(/'/g, "\\'");
      const catEsc = cat.name.replace(/'/g, "\\'");

      const addEquipBtn = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','machine')">+ Add Machine</button>`;
      const addPostBtn  = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','post')">+ Add Post Process</button>`;
      const addMaxBtn   = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','max')">+ Add</button>`;
      const addMinBtn   = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','min')">+ Add</button>`;
      const machinesHtml = `<div style="display:flex;flex-direction:column;gap:4px;">
        <div class="mfr-machines"><span class="cap-label">Machines:</span> ${equipList ? equipList + ' ' : ''}${addEquipBtn}</div>
        <div class="mfr-machines"><span class="cap-label">Post Processes:</span> ${postList ? postList + ' ' : ''}${addPostBtn}</div>
      </div>`;

      const catDims = m.dims && m.dims[cat.name];
      const isPerMachine = catDims && !('min' in catDims) && !('max' in catDims) && Object.keys(catDims).length > 0;
      let dimsHtml;
      if (isPerMachine) {
        const rows = Object.entries(catDims).map(([mach, d]) => {
          const me = mach.replace(/'/g, "\\'");
          const maxB = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','max','${me}')">+ Add</button>`;
          const minB = `<button class="add-info-btn" onclick="openUpdateModal('${mfrEsc}','${catEsc}','min','${me}')">+ Add</button>`;
          return `<div style="margin-bottom:2px;white-space:nowrap"><span class="cap-label" style="font-size:10px">${mach}:</span> Max: ${d && d.max ? d.max : maxB} ¬∑ Min: ${d && d.min ? d.min : minB}</div>`;
        }).join('');
        dimsHtml = `<div class="mfr-dims">${rows}</div>`;
      } else {
        dimsHtml = `<div class="mfr-dims">${
          catDims && catDims.max ? `Max: ${catDims.max}` : `Max: ${addMaxBtn}`
        }<br>${
          catDims && catDims.min ? `Min: ${catDims.min}` : `Min: ${addMinBtn}`
        }</div>`;
      }

      return `
      <div class="mfr-card" style="animation-delay:${i*0.03}s" onclick="if(!event.target.closest('button'))window.open('${m.url}','_blank','noopener')">
        <div class="mfr-card-top">
          <div style="display:flex;align-items:center;gap:8px;">
            ${(m.beta || (m.betaCategories && m.betaCategories.includes(cat.name))) ? '<span class="tag tag-beta">Beta</span>' : ''}
            <span class="mfr-name">${m.name}</span>
          </div>
          <div class="mfr-meta">
            ${m.quote==='instant'
              ? '<span class="tag tag-instant">‚ö° Instant Quote</span>'
              : m.quote==='online-manual'
              ? '<span class="tag tag-online-manual">üñ•Ô∏è Online Platform Manual Quote</span>'
              : '<span class="tag tag-email">‚úâÔ∏è Email/Form Submission Quote</span>'}
            ${m.uber ? '<span class="tag tag-uber">üöó Uber Courier</span>' : ''}
          </div>
        </div>
        <div class="mfr-card-bottom">
          ${(m.locations || m.city || m.state) ? `<div style="display:flex;flex-direction:column;gap:2px;">${m.locations ? m.locations.map(l => `<div class="mfr-location">üìç ${[l.city, l.state].filter(Boolean).join(', ')}</div>`).join('') : `<div class="mfr-location">üìç ${[m.city, m.state].filter(Boolean).join(', ')}</div>`}</div>` : ''}
          ${machinesHtml}
          ${dimsHtml}
        </div>
      </div>`;
    }).join('');

    return `
      <div class="category-section">
        <div class="category-header">
          <span class="category-title">${cat.name}</span>
        </div>
        <div class="section-stripe"></div>
        <div class="mfr-list">${cards}</div>
        <button class="add-mfr-btn" onclick="openSubmitModal()">+ Add Manufacturer</button>
      </div>`;
  }).join('');

  document.getElementById('main-content').innerHTML = html ||
    `<div class="empty-state">
       <div class="empty-icon">üîç</div>
       <h3>No manufacturers match your filters</h3>
       <p>Try broadening your search or <button class="clear-btn" onclick="clearFilters()">clear filters</button>.</p>
     </div>`;

}

// ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ
function openModal(id)  { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

document.querySelectorAll('.modal-overlay').forEach(o =>
  o.addEventListener('click', function(e) { if (e.target===this) this.classList.remove('active'); }));
document.addEventListener('keydown', e => {
  if (e.key==='Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
});
document.addEventListener('click', e => {
  if (!e.target.closest('.dropdown-wrap')) {
    document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
    document.querySelectorAll('.dropdown-trigger').forEach(t => t.classList.remove('open'));
  }
});

// Manufacturers pinned to top of specific categories (rendered in order before the shuffled rest)
const pinnedTop = {};

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ‚îÄ‚îÄ INLINE FORMS ‚îÄ‚îÄ
function openUpdateModal(mfrName, category, updateType, machine = '') {
  // Reset all fields
  ['machine','post','max','min','process','notes','mfr'].forEach(f => {
    document.getElementById('um-field-' + f).classList.add('field-hidden');
    if (document.getElementById('um-' + f)) document.getElementById('um-' + f).value = '';
  });
  document.getElementById('um-mfr-editable').value = '';
  document.getElementById('um-extra').value = '';
  document.getElementById('um-email').value = '';
  document.getElementById('update-form').style.display = '';
  document.getElementById('update-success').style.display = 'none';
  const btn = document.getElementById('um-submit-btn');
  btn.textContent = 'Submit'; btn.disabled = false;

  // Store context
  document.getElementById('um-mfr-name').value    = mfrName || '';
  document.getElementById('um-category').value    = category || '';
  const typeLabels = {
    machine:   'Add Machine',
    post:      'Add Post Process',
    max:       'Add Max Part Size',
    min:       'Add Min Part Size',
    incorrect: 'Incorrect Information',
    request:   'Request a Category',
  };
  document.getElementById('um-type').value = typeLabels[updateType] || updateType;
  document.getElementById('um-machine-name').value = machine || '';

  // Context badge
  const ctx = document.getElementById('um-context');
  const ctxParts = [mfrName, category, machine].filter(Boolean);
  if (ctxParts.length) {
    ctx.innerHTML = ctxParts.map((p, i) => i === 0 ? `<strong>${p}</strong>` : p).join(' ¬∑ ');
    ctx.classList.remove('field-hidden');
  } else {
    ctx.classList.add('field-hidden');
  }

  // Title + icon by type
  const cfg = {
    machine:   { icon: '‚öôÔ∏è', title: 'Add a Machine' },
    post:      { icon: 'üîß', title: 'Add a Post Process' },
    max:       { icon: 'üìê', title: 'Add Max Part Size' },
    min:       { icon: 'üìê', title: 'Add Min Part Size' },
    incorrect: { icon: '‚öë',  title: 'Report Incorrect Info' },
    request:   { icon: '‚ûï', title: 'Request a Category' },
  }[updateType] || { icon: '‚úèÔ∏è', title: 'Add Information' };
  document.getElementById('um-icon').textContent  = cfg.icon;
  document.getElementById('um-title').textContent = cfg.title;

  // Show the relevant primary field
  const fieldMap = { machine:'machine', post:'post', max:'max', min:'min', incorrect:'notes', request:'process' };
  const fieldId  = fieldMap[updateType];
  if (fieldId) document.getElementById('um-field-' + fieldId).classList.remove('field-hidden');

  // For global "report incorrect" with no mfr pre-filled, show editable mfr field
  if (updateType === 'incorrect' && !mfrName) {
    document.getElementById('um-field-mfr').classList.remove('field-hidden');
  }

  // Hide the extra notes for 'incorrect' (the notes field IS the primary input)
  document.getElementById('um-field-extra').classList.toggle('field-hidden', updateType === 'incorrect');

  openModal('update-modal');
}

function openSubmitModal() {
  ['sm-name','sm-url','sm-city','sm-state','sm-categories','sm-notes','sm-email'].forEach(id => {
    document.getElementById(id).value = '';
    document.getElementById(id).classList.remove('invalid');
  });
  document.getElementById('sm-quote').value = '';
  document.getElementById('submit-form').style.display = '';
  document.getElementById('submit-success').style.display = 'none';
  const btn = document.getElementById('sm-submit-btn');
  btn.textContent = 'Submit Manufacturer'; btn.disabled = false;
  openModal('submit-modal');
}

async function submitUpdateForm() {
  const type       = document.getElementById('um-type').value;
  const mfrName    = document.getElementById('um-mfr-name').value || document.getElementById('um-mfr-editable').value;
  const machineName = document.getElementById('um-machine-name').value;
  const extra      = document.getElementById('um-extra').value;
  const processReq = document.getElementById('um-process').value;
  const notes      = [document.getElementById('um-notes').value, extra].filter(Boolean).join(' | ');
  // Prefix machine name onto size values so reviewer knows which machine it's for
  const sizePrefix = machineName ? `[${machineName}] ` : '';

  const f = FORMS.updateInfo.fields;
  const data = {
    [f.mfrName]:    mfrName,
    [f.category]:   processReq || document.getElementById('um-category').value,
    [f.updateType]: type,
    [f.machineName]:document.getElementById('um-machine-name').value,
    [f.machine]:    document.getElementById('um-machine').value,
    [f.postProcess]:document.getElementById('um-post').value,
    [f.minSize]:    document.getElementById('um-min').value ? sizePrefix + document.getElementById('um-min').value : '',
    [f.maxSize]:    document.getElementById('um-max').value ? sizePrefix + document.getElementById('um-max').value : '',
    [f.notes]:      notes,
    [f.email]:      document.getElementById('um-email').value,
  };

  const btn = document.getElementById('um-submit-btn');
  btn.textContent = 'Sending‚Ä¶'; btn.disabled = true;
  await postToGoogleForms(FORMS.updateInfo.endpoint, data);
  closeModal('update-modal');
  showToast();
}

async function submitMfrForm() {
  const name = document.getElementById('sm-name').value.trim();
  const url  = document.getElementById('sm-url').value.trim();
  document.getElementById('sm-name').classList.toggle('invalid', !name);
  document.getElementById('sm-url').classList.toggle('invalid',  !url);
  if (!name || !url) return;

  const f = FORMS.submitMfr.fields;
  const data = {
    [f.companyName]: name,
    [f.url]:         url,
    [f.city]:        document.getElementById('sm-city').value,
    [f.state]:       document.getElementById('sm-state').value,
    [f.quoteType]:   document.getElementById('sm-quote').value,
    [f.categories]:  document.getElementById('sm-categories').value,
    [f.notes]:       document.getElementById('sm-notes').value,
    [f.email]:       document.getElementById('sm-email').value,
  };

  const btn = document.getElementById('sm-submit-btn');
  btn.textContent = 'Sending‚Ä¶'; btn.disabled = true;
  await postToGoogleForms(FORMS.submitMfr.endpoint, data);
  closeModal('submit-modal');
  showToast();
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
buildDropdowns();
applyFilters();

</script>

<div class="toast" id="toast">Response submitted.</div>
</body>
</html>
